# Отчёт по проекту CI/CD #

## 1. Установка gitlab-runner ##

+ **Runner установлен и настроен на текущий проект с помощью токена. Создан новый пользователь - gitlab-runner.**

## 2-4. Всё до деплоя ##

+ **Прописываем в файл .gitlab-ci.yml все те bash-команды, которые пишем в консоли для запуска каждого этапа. При запуске под экзекьютором shell из-под ubuntu лучше прописывать запуск скриптов через не просто sh, а именно bash, так как sh вызовет shell по умолчанию, который в ubuntu - не bash, a dash, и команд баша не понимает. ** 

## 5. Деплой ##

+ **Настраиваем адаптеры виртуальных машин - второй адаптер выставляем в режим Внутренняя сеть и задаём следующие настройки**

![Netplan bubuntanew](https://github.com/VTsabina/DevOps_projects/blob/main/CICD/datasets/bubuntanew.png "Netplan bubuntanew")

[Настройки машины, с которой будет производиться "деплой"]

![Netplan bubuntanew2](https://github.com/VTsabina/DevOps_projects/blob/main/CICD/datasets/bubuntanew2.png "Netplan bubuntanew2")

[Настройки машины, на которую будут копироваться файлы]

**Теперь на второй машине через chmod устанавливаем доступ к директории /ust/local/bin так, чтобы у нас было право на копирование.**
**После этого командой ssh-copy-id ubuntu@10.10.0.1 передаем ключ на целевую машину, чтобы она не запрашивала пароль - в пайплайне мы его ввести не сможем.**
**После этого всё будет работать.**
**На гите раннер будет действовать под пользователем gitlab-runner, которого он создал при регистрации. Поэтому, чтобы всё заработало не только на локальной машине, но и в гитлабе, надо:**

 + **Переключиться на пользователя gitlab-runner через команду sudo su gitlab-runner**

 + **Из-под него сгенерировать ключ ssh-keygen**

 + **Этот ключ отослать на целевую машину ssh-copy-id ubuntu@10.10.0.1** 

 + **Этот же ключ добавить в свой гит**

## Бонус. Телегабот ##

**Получаем токен у ботфазера, получаем свой айди у getmyid и отправляем себе простенькое сообщение о состоянии текущей стадии. Если running - значит, всё прошло хорошо.**
**Если этап не прошёл, сообщения не приходят.**

![Телегабот](https://github.com/VTsabina/DevOps_projects/blob/main/CICD/datasets/telegram.png "Телегабот")

[Вывод телегабота]
