# Отчёт по проекту CI/CD #

## 1. Установка gitlab-runner ##

+ **Итак, здесь мог бы быть скриншот, но он почему-то побился. Но после установки трёх раннеров (на школьную машину (зачем-то), на свою основную и на виртуалку) в принципе я могу этот скриншот цитировать. С выражением. **

## 2-4. Всё до деплоя ##

+ **Прописываем в файл .gitlab-ci.yml все те bash-команды, которые пишем в консоли, ничего сверхъестественного. Единственное, при запуске под экзекьюторов shell из-под ubuntu лучше прописывать при запуске скриптов не просто sh, а именно bash, так как sh вызовет shell по умолчанию, который в ubuntu - внезапно - не bash, a dash, и команд баша не понимает. ** 

## 5. Деплой ##

+ **С "деплоем" через ssh пришлось повозиться. Что же надо сделать, чтобы заработало? Во-первых, настроить адаптеры виртуальных машин - второй адаптер поставить в режим Внутренняя сеть и задать следующие настройки**

![Netplan bubuntanew](https://github.com/VTsabina/DevOps_projects/tree/main/CICD/datasets/bubuntanew.png "Netplan bubuntanew")

[Настройки машины, с которой будет производиться "деплой"]

![Netplan bubuntanew2](https://github.com/VTsabina/DevOps_projects/tree/main/CICD/datasets/bubuntanew2.png "Netplan bubuntanew2")

[Настройки машины, на которую будут копироваться файлы]

**Теперь на второй машине через chmod устанавливаем доступ к директории /ust/local/bin так, чтобы у нас было права туда что-то копировать.**
**После этого надо командой ssh-copy-id ubuntu@10.10.0.1 передать ключ на целевую машину, чтобы она не запрашивала пароль - в пайплайне мы его ввести, естественно, не сможем.**
**После этого всё будет работать.**

**Но не в гите.**

**На гите раннер будет действовать под пользователем gitlab-runner, которого он создал при регистрации. Поэтому, чтобы всё заработало не только на локальной машине, но и в гитлабе, надо:**

 + **Переключиться на пользователя gitlab-runner через команду sudo su gitlab-runner**

 + **Из-под него сгенерировать ключ ssh-keygen**

 + **Этот ключ отослать на целевую машину ssh-copy-id ubuntu@10.10.0.1** 

 + **Этот же ключ добавить в свой гит**

**Вуаля - всё заработало, ура.**

## Бонус. Телегабот ##

**Тут всё по классике - получаем токен у ботфазера, получаем свой айдишник у getmyid и отправляем себе простенькое сообщение о состоянии текущей стадии. Если running - значит, всё прошло хорошо.**
**Если всё прошло плохо, в смысле не прошло, сообщения не приходят.**

**Пруфы тут:**

![Телегабот](https://github.com/VTsabina/DevOps_projects/tree/main/CICD/datasets/telegram.png "Телегабот")

[Вывод телегабота]
